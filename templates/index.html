<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #0e0e0e;
            color: white;
        }
        .card {
            background: #1c1c1c;
            border: 1px solid #333;
        }
        #output {
            background: black;
            color: #e2e2e2;
            white-space: pre-line;
            padding: 20px;
            border-radius: 8px;
            font-size: 18px;
            border: 1px solid #222;
            margin-bottom: 50px;
        }
    </style>
</head>

<body>

<div class="container mt-5">

    <h1 class="text-center mb-4" style="font-size:40px">
        –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    </h1>

    <div class="card p-4">

        <div class="mb-3">
            <label class="form-label">–ß–µ–º —Ç—ã –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è</label>
            <select id="activity" class="form-select">
                <option value="work">–†–∞–±–æ—Ç–∞—é</option>
                <option value="train">–¢—Ä–µ–Ω–∏—Ä—É—é—Å—å</option>
                <option value="sleep">–ó–∞—Å—ã–ø–∞—é</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</label>
            <select id="popularity" class="form-select">
                <option value="popular">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</option>
                <option value="unpopular">–ù–µ–ø–æ–ø—É–ª—è—Ä–Ω–æ–µ</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</label>
            <select id="mood" class="form-select">
                <option value="energetic">–ë–æ–¥—Ä–æ–µ</option>
                <option value="calm">–°–ø–æ–∫–æ–π–Ω–æ–µ</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">–Ø–∑—ã–∫</label>
            <select id="language" class="form-select">
                <option value="russian">–†—É—Å—Å–∫–æ–µ</option>
                <option value="foreign">–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–µ</option>
            </select>
        </div>

        <button onclick="runClips()" class="btn btn-warning w-100">
            –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        </button>

    </div>

    <h2 class="mt-4">–í—ã–≤–æ–¥:</h2>
    <div id="output"></div>

</div>


<script>

// —Ñ–æ—Ä–º–∞—Ç–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function formatOutput(text) {
    if (!text) return "–ü—É—Å—Ç–æ–π –≤—ã–≤–æ–¥";

    text = text.replace(/CLIPS>*/g, "");
    text = text.replace(/\r/g, "");

    let out = "";

    // —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    if (text.includes("–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")) {
        out += "üéµ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n\n";
        let recs = text.match(/\* .*?,.*?,.*?/g);
        if (recs) recs.forEach(r => out += r + "\n");
        out += "\n";
    }

    // –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    if (text.includes("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏")) {
        out += "üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏\n\n";
        let cMatches = text.split("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏")[1].match(/\* .*/g);
        if (cMatches) cMatches.forEach(c => out += c + "\n");
        out += "\n";
    }

    // —Ü–µ–ø–æ—á–∫–∞ –ø—Ä–∞–≤–∏–ª
    if (text.includes("–¶–µ–ø–æ—á–∫–∞ –ø—Ä–∞–≤–∏–ª")) {
        out += "‚öôÔ∏è –¶–µ–ø–æ—á–∫–∞ –ø—Ä–∞–≤–∏–ª\n\n";
        let lMatches = text.split("–¶–µ–ø–æ—á–∫–∞ –ø—Ä–∞–≤–∏–ª")[1].match(/\* .*/g);
        if (lMatches) lMatches.forEach(l => out += l + "\n");
    }

    return out;
}


// –∑–∞–ø—É—Å–∫ CLIPS
function runClips() {

    document.getElementById("output").innerHTML =
        "<span style='color:#00ff00'>–ó–∞–≥—Ä—É–∑–∫–∞, –ø–æ–¥–æ–∂–¥–∏ —Å–∞–ª–∞–≥–∞...</span>";

    let data = {
        activity: document.getElementById("activity").value,
        popularity: document.getElementById("popularity").value,
        mood: document.getElementById("mood").value,
        language: document.getElementById("language").value
    };

    fetch("/run", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    })
        .then(r => r.json())
        .then(d => {
            if (d.output === "–û–®–ò–ë–ö–ê" || 
                d.output === "–û–®–ò–ë–ö–ê PYTHON" || 
                d.output === "–û–®–ò–ë–ö–ê CLIPSIDE") {

                document.getElementById("output").innerHTML =
                    "<span style='color:red'>–û–®–ò–ë–ö–ê</span>\n\n" +
                    d.error + "\n\n=== RAW ===\n" +
                    (d.code || "");

                return;
            }

            document.getElementById("output").innerHTML =
                formatOutput(d.output);
        });
}
</script>

</body>
</html>
